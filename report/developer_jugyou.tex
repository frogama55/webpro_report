\chapter{千葉工業大学情報変革科学部情報工学科1年次の授業一覧\\システムの開発者向け仕様書}
\section{データ構造}
\subsection{変数定義}
本システムでは，データベースソフトウェアを使用せず，アプリケーションサーバ（IDapp.js）内の配列変数jugyouにデータを格納する方法を採用している．jugyouはオブジェクトの配列変数であり，プロセス終了時にデータは消失する．

\subsection{オブジェクトの構造}
jugyou配列の各要素は，以下のプロパティを持つオブジェクトである．変数名と実データの対応関係は表\ref{KANKEI_jugyou}の通りである\cite{sankou_jugyou}．


\begin{table}[H]
    \centering
    \caption{変数名と実データの対応関係}
    \label{KANKEI_jugyou}
    \begin{tabular}{|c|c|c|c|}
        \hline
        変数名 & データ型 & 本システムでの役割 & データ例  \\ \hline
        id & Number & データの管理ID & 1   \\ \hline 
        code & String & 分野名 & "教養基礎科目"  \\ \hline
        name & String & 授業名 & "英語理解基礎１"  \\ \hline
        change & String & 必修か選択か & "選択"  \\ \hline
        passengers & Number/String & 単位数 & 1  \\ \hline
        distance & Number/String & 備考 & "基礎レベル対象の科目" \\ \hline
    \end{tabular}
\end{table}

\newpage
\section{HTTPメソッドとリソース名}
表\ref{KANKEI_jugyou_HTTP}に，リソース名とHTTPメソッドを定義する．
\begin{table}[H]
    \centering
    \caption{変数名と実データの対応関係}
    \label{KANKEI_jugyou_HTTP}
    \small
    \begin{tabularx}{\textwidth}{|c|c|l|X|}
        \hline
        機能 & HTTPメソッド & \multicolumn{1}{c|}{リソース名（URL）} & \multicolumn{1}{c|}{処理内容}  \\ \hline
        一覧表示 & GET & /jugyou & データ一覧画面（jugyou.ejs）を表示する．   \\ \hline 
        詳細表示 & GET & /jugyou/:number & 指定IDの詳細画面（jugyou\_detail.ejs）を表示する．   \\ \hline
        新規登録（画面） & GET & /jugyou/create & 新規登録フォーム（jugyou.html）へリダイレクトする．   \\ \hline
        新規登録（処理） & POST &/jugyou & フォームからデータを受け取り，配列に追加する．  \\ \hline
        編集（画面） & GET & /jugyou/edit/:number& 編集フォーム（jugyou\_edit.ejs）を表示する．   \\ \hline
        編集（処理） & POST & /jugyou/update/:number & 既存データを更新し，一覧表示画面へリダイレクトする． \\ \hline
        削除（画面） & GET & /jugyou/delete/confirm/:number & 削除確認画面（jugyou\_delete.ejs）を表示する．\\ \hline
        削除（処理） & POST &/jugyou/delete/:number & データをnull化し，一覧表示画面へリダイレクトする． \\ \hline
    \end{tabularx}
\end{table}

\newpage
\section{ページ遷移}
ページ遷移の様子を，図\ref{jugyou_page}に示す．
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.95\textwidth,clip]{fig/developer/jugyou_page.pdf}
\end{center}
\caption{\textgt{
    ページ遷移図
}}
\label{jugyou_page}
\end{figure}

\newpage
\section{機能詳細と実装上の注意点}
\subsection{新規データ追加機能（Create）}
この機能では，jugyou配列の末尾に新しいオブジェクトを追加（push）し，「jugyou.length + 1」（一番最後のIDを1大きくしたもの）を新しいIDとして付与する．追加完了後，jugyou.ejsを用いて登録済みデータ一覧ページを表示する．

\subsection{一覧表示機能（Read）}
この機能では，EJSテンプレート内でjugyou配列をループ処理し，表形式で表示する．注意点として，削除処理によって，配列内にnullが含まれる可能性があるため，EJS側でif文等を用いた確認を行い，null要素を表示しないように制御する必要がある．

\subsection{更新機能（Update）}
この機能では，URLパラメータである:numberを用いて配列にアクセスし，フォームから送信された値（req.body）で詳細を上書きする．処理完了後は，res.redirect(`/jugyou')により，一覧画面へ遷移する．　

\subsection{削除機能（Delete）}
配列の要素を削除するために，該当部分にnullを代入する．これは，spliceを使用すると，削除した部分にあとのデータが詰められるため，既存データを指す:numberがずれてしまい，詳細表示や編集時のリンク先が誤ったデータを指すことがあったためである．ejs側では表記上削除されるようにしている．